name: Quality Checks

on:
  workflow_call:

jobs:

  linting:
    uses: ./.github/workflows/_node_job.yaml
    with:
      name: ğŸ§¹  Linting
      run: pnpm lint

  typeCheck:
    uses: ./.github/workflows/_node_job.yaml
    with:
      name: ğŸ”  Type Check
      run: pnpm typecheck

  unitTest:
    uses: ./.github/workflows/_node_job.yaml
    with:
      name: ğŸ§ª  Unit Test
      run: pnpm test
      timeout-minutes: 15

  security:
    name: ğŸ”’  Security Checks
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ github.token }}
      - uses: ./.github/actions/setup-node-pnpm
      - uses: snyk/actions/setup@master

      - name: Snyk Test
        run: snyk test
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        working-directory: ${{ env.WORKING_DIR }}

      - name: Snyk Code Test
        run: snyk code test --report --project-name="lambda-toolkit" --severity-threshold=medium
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
      # - name: Run Snyk to check for vulnerabilities
      #   uses: snyk/actions/node@master
      #   env:
      #     SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
      #   with:
      #     args: --all-projects --report

